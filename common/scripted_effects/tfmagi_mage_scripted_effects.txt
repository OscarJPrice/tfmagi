add_tfmagi_mage_trait = {
    add_trait = tfmagi_mage
    add_to_global_variable_list = {
        name = tfmagi_mages_global_list
        target = this
    }
    set_variable = {
        name = tfmagi_mage_target
        value = this
    }
    set_variable = {
        name = tfmagi_mage_tonic_diplomacy_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_martial_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_stewardship_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_intrigue_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_learning_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_stress_num
        value = 0
    }
}

remove_tfmagi_mage_quicken_modifiers = {
    remove_character_modifier = tfmagi_mage_quicken_modifier_01
    remove_character_modifier = tfmagi_mage_quicken_modifier_02
    remove_character_modifier = tfmagi_mage_quicken_modifier_03
    remove_character_modifier = tfmagi_mage_quicken_modifier_04
    remove_character_modifier = tfmagi_mage_quicken_modifier_05
}

remove_tfmagi_mage_strengthen_modifiers = {
    remove_character_modifier = tfmagi_mage_strengthen_modifier_01
    remove_character_modifier = tfmagi_mage_strengthen_modifier_02
    remove_character_modifier = tfmagi_mage_strengthen_modifier_03
    remove_character_modifier = tfmagi_mage_strengthen_modifier_04
    remove_character_modifier = tfmagi_mage_strengthen_modifier_05
}

remove_tfmagi_mage_acuity_modifiers = {
    remove_character_modifier = tfmagi_mage_acuity_modifier_01
    remove_character_modifier = tfmagi_mage_acuity_modifier_02
    remove_character_modifier = tfmagi_mage_acuity_modifier_03
    remove_character_modifier = tfmagi_mage_acuity_modifier_04
    remove_character_modifier = tfmagi_mage_acuity_modifier_05
}

add_tfmagi_mage_quicken_modifier = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }
        add_character_modifier = tfmagi_mage_quicken_modifier_05
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_03
            }
        }
        add_character_modifier = tfmagi_mage_quicken_modifier_04
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_02
            }
        }
        add_character_modifier = tfmagi_mage_quicken_modifier_03
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_01
            }
        }
        add_character_modifier = tfmagi_mage_quicken_modifier_02
    }
    else = {
        add_character_modifier = tfmagi_mage_quicken_modifier_01
    }
}

add_tfmagi_mage_strengthen_modifier = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }
        add_character_modifier = tfmagi_mage_strengthen_modifier_05
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_03
            }
        }
        add_character_modifier = tfmagi_mage_strengthen_modifier_04
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_02
            }
        }
        add_character_modifier = tfmagi_mage_strengthen_modifier_03
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_01
            }
        }
        add_character_modifier = tfmagi_mage_strengthen_modifier_02
    }
    else = {
        add_character_modifier = tfmagi_mage_strengthen_modifier_01
    }
}

add_tfmagi_mage_acuity_modifier = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }
        add_character_modifier = tfmagi_mage_acuity_modifier_05
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_03
            }
        }
        add_character_modifier = tfmagi_mage_acuity_modifier_04
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_02
            }
        }
        add_character_modifier = tfmagi_mage_acuity_modifier_03
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_01
            }
        }
        add_character_modifier = tfmagi_mage_acuity_modifier_02
    }
    else = {
        add_character_modifier = tfmagi_mage_acuity_modifier_01
    }
}

add_tfmagi_mage_planar_teleport_modifier = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 75
        }
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_planar
                value >= tfmagi_mage_mastery_03
            }
        }
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 60
        }
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_planar
                value >= tfmagi_mage_mastery_02
            }
        }
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 45
        }
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_planar
                value >= tfmagi_mage_mastery_01
            }
        }
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 30
        }
    }
    else = {
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 15
        }
    }
}

create_tfmagi_mage_golems_army = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }

        custom_tooltip = tfmagi_mage_golems_tt_03
        hidden_effect = {
            spawn_army = {
                men_at_arms = {
                    type = $TYPE$
                    stacks = 3
                }
                inheritable = no
                uses_supply = no
                location = this.location
                name = tfmagi_golem_army_name_plural
            }
        }
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_02
            }
        }
        custom_tooltip = tfmagi_mage_golems_tt_02
        hidden_effect = {
            spawn_army = {
                men_at_arms = {
                    type = $TYPE$
                    stacks = 2
                }
                inheritable = no
                uses_supply = no
                location = this.location
                name = tfmagi_golem_army_name_plural
            }
        }
    }
    else = {
        custom_tooltip = tfmagi_mage_golems_tt_01
        spawn_army = {
            men_at_arms = {
                type = $TYPE$
                stacks = 1
            }
            inheritable = no
            uses_supply = no
            location = this.location
            name = tfmagi_golem_army_name
        }
    }
}

tfmagi_province_radial_effect_2 = {
    $COUNTY$ = {
        if = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
        }
        every_connected_county = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
        }
    }
}
tfmagi_province_radial_effect_3 = {
    $COUNTY$ = {
        if = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
        }
        every_connected_county = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
            
            every_connected_county = {
                limit = { 
                    $COUNTY_SCRIPTED_TRIGGER$ = yes 
                }
                $COUNTY_SCRIPTED_EFFECT$ = yes
            }
        }
    }
}
tfmagi_province_radial_effect_4 = {
    $COUNTY$ = {
        if = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
        }
        every_connected_county = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
            
            every_connected_county = {
                limit = { 
                    $COUNTY_SCRIPTED_TRIGGER$ = yes 
                }
                $COUNTY_SCRIPTED_EFFECT$ = yes
            
                every_connected_county = {
                    limit = { 
                        $COUNTY_SCRIPTED_TRIGGER$ = yes 
                    }
                    $COUNTY_SCRIPTED_EFFECT$ = yes
                }
            }
        }
    }
}

tfmagi_mage_elemental_winter_s_effect_1 = {
    hidden_effect = {
        remove_province_modifier = winter_mild_modifier
    }
    add_province_modifier = {
        modifier = winter_mild_modifier
        days = 180
    }
}
tfmagi_mage_elemental_winter_s_effect_2 = {
    hidden_effect = {
        remove_province_modifier = winter_mild_modifier
        remove_province_modifier = winter_normal_modifier
    }
    add_province_modifier = {
        modifier = winter_normal_modifier
        days = 180
    }
}
tfmagi_mage_elemental_winter_s_effect_3 = {
    hidden_effect = {
        remove_province_modifier = winter_mild_modifier
        remove_province_modifier = winter_normal_modifier
        remove_province_modifier = winter_harsh_modifier
    }
    add_province_modifier = {
        modifier = winter_harsh_modifier
        days = 180
    }
}
tfmagi_mage_elemental_seismic_s_effect_1 = {
    hidden_effect = {
        remove_county_modifier = tfmagi_elemental_seismic_modifier_01
    }
    add_county_modifier = {
        modifier = tfmagi_elemental_seismic_modifier_01
        years = 2
    }
    change_development_level = {-7 -2}
    every_county_province = {
        random_list = {
            35 = {
                destroy_random_building_variable_effect = yes
                destroy_random_building_effect = yes
            }
            65 = { }
        }
    }
}
tfmagi_mage_elemental_seismic_s_effect_2 = {
    hidden_effect = {
        remove_county_modifier = tfmagi_elemental_seismic_modifier_01
        remove_county_modifier = tfmagi_elemental_seismic_modifier_02
    }
    add_county_modifier = {
        modifier = tfmagi_elemental_seismic_modifier_02
        years = 4
    }
    change_development_level = {-18 -9}
    every_county_province = {
        while = {
            count = {2 3}
            random_list = {
                35 = {
                    destroy_random_building_variable_effect = yes
                    destroy_random_building_effect = yes
                }
                65 = { }
            }
        }
    }
}
tfmagi_mage_elemental_seismic_s_effect_3 = {
    hidden_effect = {
        remove_county_modifier = tfmagi_elemental_seismic_modifier_01
        remove_county_modifier = tfmagi_elemental_seismic_modifier_02
        remove_county_modifier = tfmagi_elemental_seismic_modifier_03
    }
    add_county_modifier = {
        modifier = tfmagi_elemental_seismic_modifier_03
        years = 8
    }
    change_development_level = {-36 -18}
    every_county_province = {
        while = {
            count = {5 3}
            random_list = {
                35 = {
                    destroy_random_building_variable_effect = yes
                    destroy_random_building_effect = yes
                }
                65 = { }
            }
        }
    }
}