add_tfmagi_mage_trait = {
    add_trait = tfmagi_mage
    add_to_global_variable_list = {
        name = tfmagi_mages_global_list
        target = this
    }
    set_variable = {
        name = tfmagi_mage_target
        value = this
    }
    set_variable = {
        name = tfmagi_mage_tonic_diplomacy_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_martial_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_stewardship_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_intrigue_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_learning_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_tonic_stress_loss_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_immortality_elixir_num
        value = 0
    }
    set_variable = {
        name = tfmagi_mage_panacea_num
        value = 0
    }
}

remove_tfmagi_mage_quicken_modifiers = {
    remove_character_modifier = tfmagi_mage_quicken_modifier_01
    remove_character_modifier = tfmagi_mage_quicken_modifier_02
    remove_character_modifier = tfmagi_mage_quicken_modifier_03
    remove_character_modifier = tfmagi_mage_quicken_modifier_04
    remove_character_modifier = tfmagi_mage_quicken_modifier_05
}

remove_tfmagi_mage_strengthen_modifiers = {
    remove_character_modifier = tfmagi_mage_strengthen_modifier_01
    remove_character_modifier = tfmagi_mage_strengthen_modifier_02
    remove_character_modifier = tfmagi_mage_strengthen_modifier_03
    remove_character_modifier = tfmagi_mage_strengthen_modifier_04
    remove_character_modifier = tfmagi_mage_strengthen_modifier_05
}

remove_tfmagi_mage_acuity_modifiers = {
    remove_character_modifier = tfmagi_mage_acuity_modifier_01
    remove_character_modifier = tfmagi_mage_acuity_modifier_02
    remove_character_modifier = tfmagi_mage_acuity_modifier_03
    remove_character_modifier = tfmagi_mage_acuity_modifier_04
    remove_character_modifier = tfmagi_mage_acuity_modifier_05
}

add_tfmagi_mage_quicken_modifier = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }
        add_character_modifier = tfmagi_mage_quicken_modifier_05
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_03
            }
        }
        add_character_modifier = tfmagi_mage_quicken_modifier_04
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_02
            }
        }
        add_character_modifier = tfmagi_mage_quicken_modifier_03
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_01
            }
        }
        add_character_modifier = tfmagi_mage_quicken_modifier_02
    }
    else = {
        add_character_modifier = tfmagi_mage_quicken_modifier_01
    }
}

add_tfmagi_mage_strengthen_modifier = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }
        add_character_modifier = tfmagi_mage_strengthen_modifier_05
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_03
            }
        }
        add_character_modifier = tfmagi_mage_strengthen_modifier_04
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_02
            }
        }
        add_character_modifier = tfmagi_mage_strengthen_modifier_03
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_01
            }
        }
        add_character_modifier = tfmagi_mage_strengthen_modifier_02
    }
    else = {
        add_character_modifier = tfmagi_mage_strengthen_modifier_01
    }
}

add_tfmagi_mage_acuity_modifier = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }
        add_character_modifier = tfmagi_mage_acuity_modifier_05
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_03
            }
        }
        add_character_modifier = tfmagi_mage_acuity_modifier_04
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_02
            }
        }
        add_character_modifier = tfmagi_mage_acuity_modifier_03
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_01
            }
        }
        add_character_modifier = tfmagi_mage_acuity_modifier_02
    }
    else = {
        add_character_modifier = tfmagi_mage_acuity_modifier_01
    }
}

add_tfmagi_mage_planar_teleport_modifier = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 75
        }
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_planar
                value >= tfmagi_mage_mastery_03
            }
        }
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 60
        }
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_planar
                value >= tfmagi_mage_mastery_02
            }
        }
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 45
        }
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_planar
                value >= tfmagi_mage_mastery_01
            }
        }
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 30
        }
    }
    else = {
        add_character_modifier = {
            modifier = $TP_MODIFIER$ 
            days = 15
        }
    }
}

create_tfmagi_mage_golems_army = {
    if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_04
            }
        }

        custom_tooltip = tfmagi_mage_golems_tt_03
        hidden_effect = {
            spawn_army = {
                men_at_arms = {
                    type = $TYPE$
                    stacks = 3
                }
                inheritable = no
                uses_supply = no
                location = this.location
                name = tfmagi_golem_army_name_plural
            }
        }
    }
    else_if = {
        limit = {
            has_trait_xp = {
                trait = tfmagi_mage
                track = tfmagi_mage_mastery
                value >= tfmagi_mage_mastery_02
            }
        }
        custom_tooltip = tfmagi_mage_golems_tt_02
        hidden_effect = {
            spawn_army = {
                men_at_arms = {
                    type = $TYPE$
                    stacks = 2
                }
                inheritable = no
                uses_supply = no
                location = this.location
                name = tfmagi_golem_army_name_plural
            }
        }
    }
    else = {
        custom_tooltip = tfmagi_mage_golems_tt_01
        spawn_army = {
            men_at_arms = {
                type = $TYPE$
                stacks = 1
            }
            inheritable = no
            uses_supply = no
            location = this.location
            name = tfmagi_golem_army_name
        }
    }
}

tfmagi_province_radial_effect_2 = {
    $COUNTY$ = {
        if = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
        }
        every_connected_county = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
        }
    }
}
tfmagi_province_radial_effect_3 = {
    $COUNTY$ = {
        if = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
        }
        every_connected_county = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
            
            every_connected_county = {
                limit = { 
                    $COUNTY_SCRIPTED_TRIGGER$ = yes 
                }
                $COUNTY_SCRIPTED_EFFECT$ = yes
            }
        }
    }
}
tfmagi_province_radial_effect_4 = {
    $COUNTY$ = {
        if = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
        }
        every_connected_county = {
            limit = { 
                $COUNTY_SCRIPTED_TRIGGER$ = yes 
            }
            $COUNTY_SCRIPTED_EFFECT$ = yes
            
            every_connected_county = {
                limit = { 
                    $COUNTY_SCRIPTED_TRIGGER$ = yes 
                }
                $COUNTY_SCRIPTED_EFFECT$ = yes
            
                every_connected_county = {
                    limit = { 
                        $COUNTY_SCRIPTED_TRIGGER$ = yes 
                    }
                    $COUNTY_SCRIPTED_EFFECT$ = yes
                }
            }
        }
    }
}

tfmagi_mage_elemental_winter_s_effect_1 = {
    hidden_effect = {
        remove_province_modifier = winter_mild_modifier
    }
    add_province_modifier = {
        modifier = winter_mild_modifier
        days = 180
    }
}
tfmagi_mage_elemental_winter_s_effect_2 = {
    hidden_effect = {
        remove_province_modifier = winter_mild_modifier
        remove_province_modifier = winter_normal_modifier
    }
    add_province_modifier = {
        modifier = winter_normal_modifier
        days = 180
    }
}
tfmagi_mage_elemental_winter_s_effect_3 = {
    hidden_effect = {
        remove_province_modifier = winter_mild_modifier
        remove_province_modifier = winter_normal_modifier
        remove_province_modifier = winter_harsh_modifier
    }
    add_province_modifier = {
        modifier = winter_harsh_modifier
        days = 180
    }
}
tfmagi_mage_elemental_seismic_s_effect_1 = {
    hidden_effect = {
        remove_county_modifier = tfmagi_elemental_seismic_modifier_01
    }
    add_county_modifier = {
        modifier = tfmagi_elemental_seismic_modifier_01
        years = 2
    }
    change_development_level = {-7 -2}
    every_county_province = {
        random_list = {
            35 = {
                destroy_random_building_variable_effect = yes
                destroy_random_building_effect = yes
            }
            65 = { }
        }
    }
}
tfmagi_mage_elemental_seismic_s_effect_2 = {
    hidden_effect = {
        remove_county_modifier = tfmagi_elemental_seismic_modifier_01
        remove_county_modifier = tfmagi_elemental_seismic_modifier_02
    }
    add_county_modifier = {
        modifier = tfmagi_elemental_seismic_modifier_02
        years = 4
    }
    change_development_level = {-18 -9}
    every_county_province = {
        while = {
            count = {2 3}
            random_list = {
                35 = {
                    destroy_random_building_variable_effect = yes
                    destroy_random_building_effect = yes
                }
                65 = { }
            }
        }
    }
}
tfmagi_mage_elemental_seismic_s_effect_3 = {
    hidden_effect = {
        remove_county_modifier = tfmagi_elemental_seismic_modifier_01
        remove_county_modifier = tfmagi_elemental_seismic_modifier_02
        remove_county_modifier = tfmagi_elemental_seismic_modifier_03
    }
    add_county_modifier = {
        modifier = tfmagi_elemental_seismic_modifier_03
        years = 8
    }
    change_development_level = {-36 -18}
    every_county_province = {
        while = {
            count = {5 3}
            random_list = {
                35 = {
                    destroy_random_building_variable_effect = yes
                    destroy_random_building_effect = yes
                }
                65 = { }
            }
        }
    }
}

tfmagi_mage_add_random_ai_experience = {
    if = {
        limit = {
            is_ai = yes
            has_trait = tfmagi_mage
        }
        random_list = {
            10 = {
                random_list = {
                    20 = {
                        add_trait_xp = {
                            trait = tfmagi_mage
                            track = tfmagi_mage_alteration 
                            value = 1
                        }
                    }
                    20 = {
                        add_trait_xp = {
                            trait = tfmagi_mage
                            track = tfmagi_mage_conjuration
                            value = 1
                        }
                    }
                    20 = {
                        add_trait_xp = {
                            trait = tfmagi_mage
                            track = tfmagi_mage_elemental
                            value = 1
                        }
                    }
                    20 = {
                        add_trait_xp = {
                            trait = tfmagi_mage
                            track = tfmagi_mage_mastery 
                            value = 1
                        }
                    }
                }
            }
            20 = {
                
            }
        }
       
    }
}

tfmagi_focus_on_arcane_clear =  {
    remove_character_modifier = tfmagi_learning_elemental_modifier
    remove_character_modifier = tfmagi_learning_alteration_modifier
    remove_character_modifier = tfmagi_learning_conjuration_modifier
    remove_character_modifier = tfmagi_gathering_mana_modifier
}

tfmagi_inflict_wound_effect = {
	if = {
		limit = {
			has_trait = wounded_1
		}
		remove_trait = wounded_1
		add_trait = wounded_2
	}
	else_if = {
		limit = {
			has_trait = wounded_2
		}
		remove_trait = wounded_2
		add_trait = wounded_3
	}
	else = {
		add_trait = wounded_1
	}
}

tfmagi_heal_injury_effect = {
	if = {
		limit = {
			has_trait = wounded_3
		}
		remove_trait = wounded_3
		add_trait = wounded_2
	}
	else_if = {
		limit = {
			has_trait = wounded_2
		}
		remove_trait = wounded_2
		add_trait = wounded_1
	}
	else = {
		remove_trait = wounded_1
	}
}

tfmagi_cure_illness_effect = {
    if = {
        limit = { has_trait = ill }
        remove_trait = ill
    }
    else_if = {
        limit = { has_trait = pneumonic }
        remove_trait = pneumonic
    }
    else_if = {
        limit = { has_trait = great_pox }
        remove_trait = great_pox
    }
    else_if = {
        limit = { has_trait = early_great_pox }
        remove_trait = early_great_pox
    }
    else_if = {
        limit = { has_trait = lovers_pox }
        remove_trait = lovers_pox
    }
    else_if = {
        limit = { has_trait = leper }
        remove_trait = leper
    }
    else_if = {
        limit = { has_trait = cancer }
        remove_trait = cancer
    }
    else_if = {
        limit = { has_trait = consumption }
        remove_trait = consumption
    }
    else_if = {
        limit = { has_trait = typhus }
        remove_trait = typhus
    }
    else_if = {
        limit = { has_trait = bubonic_plague }
        remove_trait = bubonic_plague
    }
    else_if = {
        limit = { has_trait = smallpox }
        remove_trait = smallpox
    }
    else_if = {
        limit = { has_trait = measles }
        remove_trait = measles
    }
    else_if = {
        limit = { has_trait = dysentery }
        remove_trait = dysentery
    }
    else_if = {
        limit = { has_trait = ergotism }
        remove_trait = ergotism
    }
    else_if = {
        limit = { has_trait = gout_ridden }
        remove_trait = gout_ridden
    }
    else_if = {
        limit = { has_trait = sickly }
        remove_trait = sickly
    }
    else_if = {
        limit = { has_trait = infirm }
        remove_trait = infirm
    }
    else_if = {
        limit = { has_trait = incapable }
        remove_trait = incapable
    }
}

tfmagi_mend_imperfections_effect = {
    if = {
        limit = { has_trait = maimed }
        remove_trait = maimed
    }
    else_if = {
        limit = { has_trait = disfigured }
        remove_trait = disfigured
    }
    else_if = {
        limit = { has_trait = hunchbacked }
        remove_trait = hunchbacked
    }
    else_if = {
        limit = { has_trait = one_eyed }
        remove_trait = one_eyed
    }
    else_if = {
        limit = { has_trait = one_legged }
        remove_trait = one_legged
    }
    else_if = {
        limit = { has_trait = scarred }
        remove_trait = scarred
    }
    else_if = {
        limit = { has_trait = eunuch_1 }
        remove_trait = eunuch_1
    }
    else_if = {
        limit = { has_trait = beardless_eunuch }
        remove_trait = beardless_eunuch
    }
    else_if = {
        limit = { has_trait = blind }
        remove_trait = blind
    }
    else_if = {
        limit = { has_trait = hunchbacked }
        remove_trait = hunchbacked
    }
    else_if = {
        limit = { has_trait = clubfooted }
        remove_trait = clubfooted
    }
    else_if = {
        limit = { has_trait = lisping }
        remove_trait = lisping
    }
    else_if = {
        limit = { has_trait = stuttering }
        remove_trait = stuttering
    }
    else_if = {
        limit = { has_trait = inbred }
        remove_trait = inbred
    }
    else_if = {
        limit = { has_trait = weak }
        remove_trait = weak
    }
    else_if = {
        limit = { has_trait = dull }
        remove_trait = dull
    }
    else_if = {
        limit = { has_trait = impotent }
        remove_trait = impotent
    }
    else_if = {
        limit = { has_trait = spindly }
        remove_trait = spindly
    }
    else_if = {
        limit = { has_trait = wheezing }
        remove_trait = wheezing
    }
    else_if = {
        limit = { has_trait = bleeder }
        remove_trait = bleeder
    }
}

tfmagi_add_one_level_of_genetic_beauty_intellect_physique_effect = {
    random_list = {
        33 = {  # Beauty upgrade
            modifier = {
                factor = 0
                has_trait = beauty_good_3
            }
            if = {
                limit = { has_trait = beauty_bad_3 }
                remove_trait = beauty_bad_3
                add_trait = beauty_bad_2
            }
            else_if = {
                limit = { has_trait = beauty_bad_2 }
                remove_trait = beauty_bad_2
                add_trait = beauty_bad_1
            }
            else_if = {
                limit = { has_trait = beauty_bad_1 }
                remove_trait = beauty_bad_1
            }
            else_if = {
                limit = { has_trait = beauty_good_2 }
                remove_trait = beauty_good_2
                add_trait = beauty_good_3
            }
            else_if = {
                limit = { has_trait = beauty_good_1 }
                remove_trait = beauty_good_1
                add_trait = beauty_good_2
            }
            else = {
                add_trait = beauty_good_1
            }
        }
        33 = {  # Intellect upgrade
            modifier = {
                factor = 0
                has_trait = intellect_good_3
            }
            if = {
                limit = { has_trait = intellect_bad_3 }
                remove_trait = intellect_bad_3
                add_trait = intellect_bad_2
            }
            else_if = {
                limit = { has_trait = intellect_bad_2 }
                remove_trait = intellect_bad_2
                add_trait = intellect_bad_1
            }
            else_if = {
                limit = { has_trait = intellect_bad_1 }
                remove_trait = intellect_bad_1
            }
            else_if = {
                limit = { has_trait = intellect_good_2 }
                remove_trait = intellect_good_2
                add_trait = intellect_good_3
            }
            else_if = {
                limit = { has_trait = intellect_good_1 }
                remove_trait = intellect_good_1
                add_trait = intellect_good_2
            }
            else = {
                add_trait = intellect_good_1
            }
        }
        33 = {  # Physique upgrade
            modifier = {
                factor = 0
                has_trait = physique_good_3
            }
            if = {
                limit = { has_trait = physique_bad_3 }
                remove_trait = physique_bad_3
                add_trait = physique_bad_2
            }
            else_if = {
                limit = { has_trait = physique_bad_2 }
                remove_trait = physique_bad_2
                add_trait = physique_bad_1
            }
            else_if = {
                limit = { has_trait = physique_bad_1 }
                remove_trait = physique_bad_1
            }
            else_if = {
                limit = { has_trait = physique_good_2 }
                remove_trait = physique_good_2
                add_trait = physique_good_3
            }
            else_if = {
                limit = { has_trait = physique_good_1 }
                remove_trait = physique_good_1
                add_trait = physique_good_2
            }
            else = {
                add_trait = physique_good_1
            }
        }
    }
}

tfmagi_mage_lose_mana_level_01 = {
    add_trait_xp = {
        trait = tfmagi_mage
        track = tfmagi_mage_mana
        value = tfmagi_mana_cost_01
    }
    send_interface_toast = {
        type = event_toast_effect_bad
        title = tfmagi_mana_lost_toast.t
        left_icon = root
        custom_tooltip = tfmagi_mana_lost_01_toast.tt
    }
}

tfmagi_mage_lose_mana_level_02 = {
    add_trait_xp = {
        trait = tfmagi_mage
        track = tfmagi_mage_mana
        value = tfmagi_mana_cost_02
    }
    send_interface_toast = {
        type = event_toast_effect_bad
        title = tfmagi_mana_lost_toast.t
        left_icon = root
        custom_tooltip = tfmagi_mana_lost_02_toast.tt
    }
}

tfmagi_mage_lose_mana_level_03 = {
    add_trait_xp = {
        trait = tfmagi_mage
        track = tfmagi_mage_mana
        value = tfmagi_mana_cost_03
    }
    send_interface_toast = {
        type = event_toast_effect_bad
        title = tfmagi_mana_lost_toast.t
        left_icon = root
        custom_tooltip = tfmagi_mana_lost_03_toast.tt
    }
}

tfmagi_mage_lose_mana_level_04 = {
    add_trait_xp = {
        trait = tfmagi_mage
        track = tfmagi_mage_mana
        value = tfmagi_mana_cost_04
    }
    send_interface_toast = {
        type = event_toast_effect_bad
        title = tfmagi_mana_lost_toast.t
        left_icon = root
        custom_tooltip = tfmagi_mana_lost_04_toast.tt
    }
}

tfmagi_mage_lose_mana_level_05 = {
    add_trait_xp = {
        trait = tfmagi_mage
        track = tfmagi_mage_mana
        value = tfmagi_mana_cost_05
    }
    send_interface_toast = {
        type = event_toast_effect_bad
        title = tfmagi_mana_lost_toast.t
        left_icon = root
        custom_tooltip = tfmagi_mana_lost_05_toast.tt
    }
}

tfmagi_mage_lose_mana_level_06 = {
    add_trait_xp = {
        trait = tfmagi_mage
        track = tfmagi_mage_mana
        value = tfmagi_mana_cost_06
    }
    send_interface_toast = {
        type = event_toast_effect_bad
        title = tfmagi_mana_lost_toast.t
        left_icon = root
        custom_tooltip = tfmagi_mana_lost_06_toast.tt
    }
}

tfmagi_mage_lose_mana_level_07 = {
    add_trait_xp = {
        trait = tfmagi_mage
        track = tfmagi_mage_mana
        value = tfmagi_mana_cost_07
    }
    send_interface_toast = {
        type = event_toast_effect_bad
        title = tfmagi_mana_lost_toast.t
        left_icon = root
        custom_tooltip = tfmagi_mana_lost_07_toast.tt
    }
}
